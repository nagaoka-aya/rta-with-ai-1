# サンプルプロジェクト

## ドメイン定義書

### 作成
- TIS
- 2019/05/07

### 変更
- TIS
- 2022/12/13

## (1) ドメイン定義の目的
対象システム内で横断的にデータモデル(ドメイン)の設計を行うことにより、テーブルごとに局所最適化された項目設計を抑止することを目的とする。

## (2) ドメイン定義に関する成果物・ツール一覧
ドメイン定義書作成に際し、関連するドキュメントやツール等の説明を行う。

### (2-1) 設計書

| 名称           | 説明                                                                 |
| -------------- | -------------------------------------------------------------------- |
| テーブル定義書 | テーブル定義が記載されているExcelファイル。                         |
| ドメイン定義書 | ドメイン定義が記載されているExcelファイル。                         |
|                | Nablarch開発標準のドメイン定義書では、ドメイン毎のバリデーションも併せて定義する。 |

### (2-2) ソースコード

| 名称           | 説明                                         |
| -------------- | -------------------------------------------- |
| Entity Class   | Entity情報を格納するJavaクラスファイル。     |
| Domain Class   | Domain情報を格納するJavaクラスファイル。     |
| DDL            | データベースにおけるデータ構造を定義するファイル。 |

### (2-3) ツール

| 名称                        | 説明                                                                 |
| --------------------------- | -------------------------------------------------------------------- |
| SI Object Browser ER        | ER図を作成するツール。ER図はEDMというファイル形式で保存することが出来る。 |
|                             | 詳細：https://products.sint.co.jp/ober                               |
| gsp-dba-maven-plugin        | DBAのルーチンワークを自動化するためのMaven Plugin。                  |
|                             | 詳細：https://github.com/coastland/gsp-dba-maven-plugin              |
| ドメインクラス自動生成ツール | ドメイン定義書をインプットとして、Domain Classを自動生成するExcelマクロファイル。 |

### (2-4) 関連ドキュメント

| 名称           | 説明                                                                 |
| -------------- | -------------------------------------------------------------------- |
| 要件定義書     | 業務要件が記載されている。これをインプットとしてER図とドメインを作成する。 |

## (3) DB設計／ドメイン定義のプロセス概要
本項ではドメイン定義のプロセスをDB設計の全体概要を含めて説明する。設計対象となるデータモデルの状況に応じて、下記2つの作業プロセスを想定している。

### (3-1) テーブル定義の変更頻度「低」の場合（既存データモデル踏襲など）

#### 基本方針
既存のデータモデルを踏襲してシステム再構築を行う場合など、対象データモデルの変更頻度が低い場合は、テーブル定義書を直接的にテーブル定義のマスタ情報として管理・運用するプロセスを採用する。

#### 作業プロセス
1. 要件定義書に記載している業務要件から、業務で取り扱う業務項目を抽出してドメイン定義書を作成する。
2. 要件定義書に記載している業務要件から、テーブル定義を抽出して、テーブル定義書を作成する。
   - その際、作業プロセス1で作成したドメイン定義書をもとにテーブルのカラム毎に使用するドメインを定義する。
3. テーブル定義書からSI Object Browser ERを使いER図を作成し、EDMファイルを出力する。
4. ドメインクラス自動生成ツールを用いてDomain Classを自動生成する。
5. gsp-dba-maven-pluginにより、EDMファイルからEntity ClassとDDLを自動生成し、DDLをもとにDBを更新する。

### (3-2) テーブル定義の変更頻度「高」の場合（新規データモデル設計時）

#### 基本方針
新規にデータモデルを設計する場合、検討過程においてデータモデルやテーブル定義に頻繁に変更が入ることが予想されるため、ER設計ツール（例：SI Object Browser ER 等）によって生成・管理するER図をマスタ情報とする。

#### 作業プロセス
1. 業務要件から、業務で取り扱う業務項目を抽出してドメイン定義書を作成する。
2. 要件定義書に記載している業務要件から、テーブル定義を抽出して、ER図を作成する（SI Object Browser ERで作成する）。
3. ER図からテーブル定義書を出力する。出力情報をテーブル定義に転記後、ドメイン定義など必要な情報を追記する。
4. ドメインクラス作成ツールを用いてDomain Classを自動生成する。
5. gsp-dba-maven-pluginにより、EDMファイルからEntity ClassとDDLを生成し、DDLをもとにDBを更新する。

## (4) ドメイン定義書の作成手順
本設計書ではドメイン定義と、ドメインで取りうる値のバリデーション定義を記載する。本設計書は3シートで構成されており、各シートの定義内容は以下の通り。

### シート名

| シート名                     | 必須 | 用途                                                                 |
| ---------------------------- | ---- | -------------------------------------------------------------------- |
| 1. ドメイン定義              | -    | -                                                                    |
| ドメイン情報                 | ○    | ドメインを定義する。                                                 |
| バリデーション情報（印刷範囲外） | ×    | ドメインの物理項目名や、バリデーション定義との紐づけ情報を定義する。 |
| 2.1. Nablarch標準提供バリデーション | ×    | Nablarchでフレームワーク標準提供のバリデーションを定義している。     |
|                              |      | これらバリデーションに対してプロジェクトで使用するメッセージ情報を記載する。 |
| 2.2. 本システム固有のバリデーション | ×    | 「2.1. Nablarch標準提供バリデーション」シートで提供しているバリデーションの他にプロジェクトで独自のバリデーションを定義する場合は本シートに定義する。 |

### 作業手順
1. 「1. ドメイン定義」シートのドメイン情報を記述して、ドメインの概要を定義する。
2. 「2.1. Nablarch標準提供バリデーション」にプロジェクトで使用するメッセージ情報を定義する。
3. 「2.2. 本システム固有のバリデーション」を記述して、手順1で定義したドメインの値を精査するためのプロジェクト独自のバリデーションを定義する。
4. 「1. ドメイン定義」シートのバリデーション情報（印刷範囲外）を記述して、ドメインクラス生成ツールで必要なドメインの詳細を定義する。
5. ドメインクラス生成ツールに本設計書を読み込ませ、ドメインクラスを生成する。