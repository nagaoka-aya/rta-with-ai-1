# システム機能設計書（画面）

## 1. サンプルプロジェクト

### 1.1. プロジェクト更新

| No. | 領域名 | ページング有無 | ソート条件 | 備考 |
| --- | ------ | -------------- | ---------- | ---- |
| 1   | -      | -              | -          | -    |

### 1.2. 画面項目定義

| No. | 表示情報 | ドメイン名 | 【内部設計情報】 画面項目名（物理） |
| --- | -------- | ---------- | ----------------------------------- |
| 1   | プロジェクトID | プロジェクトID | projectId |
| 1   | 事業部 | 組織ID | divisionId |
| 2   | 部門 | 組織ID | organizationId |
| 3   | PJ名 | プロジェクト名 | projectName |
| 4   | PJ種別 | プロジェクト種別 | projectType |
| 5   | PJ分類 | プロジェクト分類 | projectClass |
| 6   | 売上高(千円) | 金額 | sales |
| 7   | 顧客 | 顧客ID | clientId |
| 8   | PM | ユーザ氏名（漢字） | projectManager |
| 9   | PL | ユーザ氏名（漢字） | projectLeader |
| 10  | 開始日 | 日付 | projectStartDate |
| 11  | 終了日 | 日付 | projectEndDate |
| 12  | 備考 | 備考 | note |
| 12  | バージョン番号 | バージョン番号 | versionNo |

### 1.3. 入出力一覧

| No. | 入出力名 | 種別 | I/O | DBアクセス種別 | 備考 |
| --- | -------- | ---- | --- | -------------- | ---- |
| 1   | 組織 | テーブル | I | - | - |
| 2   | プロジェクト | テーブル | I | - | - |

### 1.4. 画面イベント一覧

| No. | 画面イベント名 | 発生タイミング | 画面イベント概要 | 正常時遷移先画面 | サーバ通信有無 |
| --- | -------------- | -------------- | ---------------- | ---------------- | -------------- |
| 1   | 初期表示 | ‐ | プロジェクト更新画面を表示する。 | - | あり(同期) |
| 2   | 部門リスト取得 | 「事業部」プルダウン選択 | 選択された事業部をもとに、配下部門リストを「部門」プルダウンに設定する。 | - | あり(非同期) |
| 3   | 顧客検索 | 「顧客選択」ボタン押下 | 顧客検索画面を開く。 | 顧客検索画面 | あり(同期) |
| 4   | 戻る | 「戻る」ボタン押下 | プロジェクト詳細画面を表示する。 | プロジェクト詳細画面 | あり(同期) |
| 5   | 確認 | 「確認」ボタン押下 | 入力内容のバリデーション処理を行い、プロジェクト更新確認を表示する。 | プロジェクト更新確認 | あり(同期) |

### 1.5. 画面イベント詳細

#### 1.5.1. 初期表示イベント

1. バリデーション処理
    - なし。
2. DBアクセス（検索処理）
    - プロジェクト検索条件
        - 取得テーブル名: プロジェクト
        - 取得カラム名: プロジェクトID, プロジェクト名, プロジェクト種別, プロジェクト分類, 売上高, 顧客ID, プロジェクトマネージャー, プロジェクトリーダー, プロジェクト開始日付, プロジェクト終了日付, 備考, バージョン番号
        - 検索条件: プロジェクト．プロジェクトID = プロジェクトID(入力値)
    - 上記で取得した顧客IDをパラメータとして、顧客管理システム．顧客詳細取得APIを実行し顧客名を取得する。
    - 組織検索条件
        - 取得テーブル名: 組織
        - 取得カラム名: 組織ID, 組織名
        - 検索条件: 組織.上位組織ID = NULL
3. 表示処理
    - 「(2)-(a) プロジェクト検索条件)」の検索結果がない場合
        - 汎用エラー画面を表示する。
    - 「(2)-(a) プロジェクト検索条件)」の検索結果がある場合
        - 「事業部」プルダウンを初期化する。
            - 「(2)-(b)組織検索条件)」の検索結果の先頭にブランクオプションを追加して、「事業部」に設定する。
            - プルダウンの表示項目には組織名を、値には組織IDを使用する。
        - 検索結果を「プロジェクト更新画面」に表示する。

#### 1.5.2. 部門リスト取得イベント

1. バリデーション処理
    - なし。
2. DBアクセス（検索処理）
    - 組織検索条件
        - 取得テーブル名: 組織
        - 取得カラム名: 組織ID, 組織名
        - 検索条件: 組織.上位組織ID = 事業部（入力値）
3. 表示処理
    - 「部門」プルダウンを初期化する。
        - 「(2) 検索処理」の検索結果の先頭にブランクオプションを追加して、「部門」に設定する。
        - プルダウンの表示項目には組織名を、値には組織IDを使用する。

#### 1.5.3. 顧客検索イベント

1. バリデーション処理
    - なし。
2. 表示処理
    - 顧客検索画面をポップアップ画面として開く。

#### 1.5.4. 確認イベント

1. バリデーション処理
    - 単項目バリデーション
        - 全ての入力項目に対して、指定ドメインに応じたバリデーションおよび必須チェックを実施し、入力内容の妥当性を確認する。
    - 日付大小関係
        - 「プロジェクト開始日付」と「プロジェクト終了日付」が両方入力されている場合、「プロジェクト開始日付」≦「プロジェクト終了日付」であること。
    - 上記バリデーションにおいて一箇所でもエラーが発生した場合、後続の処理は実施しない。
2. DBアクセス（検索処理）
    - 組織検索条件
        - Formの事業部、部門には更新画面で選択された組織の組織IDが設定されている。
        - 画面には組織IDに対する組織名を表示する必要があるので、下記クエリにより組織名を取得する。
            - 取得テーブル名: 組織
            - 取得カラム名: 組織名
            - 検索条件: 組織.組織ID = 組織ID(Formから取得した組織ID)
    - Formに設定された顧客IDをパラメータとして、顧客管理システム．顧客詳細取得APIを実行し顧客名を取得する。
3. 表示処理
    - 更新画面に入力した内容を更新確認画面に表示する。画面レイアウト、表示項目については「3. プロジェクト更新確認画面」を参照。